<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Productos
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="productos-content">

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; gap: 16px;">
    <ion-spinner name="crescent" style="color: #8B4513;"></ion-spinner>
    <p style="margin: 0; color: #8B4513; font-weight: 500;">Cargando productos...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="!isLoading && hasConnectionError" style="text-align: center; padding: 60px 20px; color: #666;">
    <div style="font-size: 64px; color: #ff6b6b; margin-bottom: 16px;">‚ö†Ô∏è</div>
    <h3 style="margin: 0 0 8px 0; color: #333; font-size: 20px;">Error al cargar productos</h3>
    <p style="margin: 0 0 16px 0; font-size: 14px;">{{ connectionStatus }}</p>
    <ion-button fill="solid" (click)="retryConnection()" style="--border-radius: 10px; height: 44px;">
      <ion-icon name="refresh" slot="start"></ion-icon>
      Reintentar
    </ion-button>
  </div>

  <!-- Content (only show when loaded and no error) -->
  <div *ngIf="!isLoading && !hasConnectionError" style="margin-top: 11%;">

  <!-- Productos Section -->
  <div class="productos-section">
    <div class="container">


      <!-- Filter Buttons -->
      <div class="productos-filter">
        <!-- First Row -->
        <div class="filter-row">
          <button class="filter-btn active" data-filter="todos" (click)="setFilter('todos')">Todos</button>
          <button class="filter-btn" data-filter="Chocolate" (click)="setFilter('Chocolate')">Chocolate</button>
          <button class="filter-btn" data-filter="Sandwich" (click)="setFilter('Sandwich')">Sandwich</button>
        </div>
        <!-- Second Row -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="Bombon" (click)="setFilter('Bombon')">Bomb√≥n</button>
          <button class="filter-btn" data-filter="Caramelo" (click)="setFilter('Caramelo')">Caramelo</button>
          <button class="filter-btn" data-filter="Semilla" (click)="setFilter('Semilla')">Semilla</button>
        </div>
        <!-- Third Row -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="Tradicionales" (click)="setFilter('Tradicionales')">Tradicionales</button>
          <button class="filter-btn" data-filter="Temporales" (click)="setFilter('Temporales')">Temporales</button>
          <button class="filter-btn" data-filter="Solubles" (click)="setFilter('Solubles')">Solubles</button>
        </div>
      </div>

      <!-- Loading/Error Section -->
      <div class="status-section" style="padding: 10px; margin: 10px 0; border-radius: 5px;" [style.background]="getStatusBackground()" *ngIf="isLoading || hasConnectionError">
        <div *ngIf="isLoading" style="text-align: center;">
          <ion-icon name="refresh" style="font-size: 24px; color: #007bff; animation: spin 1s linear infinite;"></ion-icon>
          <div style="margin-top: 5px; font-size: 14px; color: #007bff;">Cargando productos...</div>
        </div>

        <div *ngIf="!isLoading && hasConnectionError" style="text-align: center;">
          <div style="font-size: 16px; color: #dc3545; margin-bottom: 10px;">‚ùå {{ connectionStatus }}</div>
          <button class="retry-btn" (click)="retryConnection()" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
            üîÑ Reintentar
          </button>
        </div>
      </div>

      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>

      <!-- Products Grid -->
      <div class="productos-grid">
        <div class="product-card" *ngFor="let product of filteredProducts" [class.animate-card-success]="animatingCardId === product.id_producto" [class.animate-quantity-change]="animatingQuantityId === product.id_producto">
          <div class="product-image">
            <img *ngIf="getImageSrc(product)" [src]="getImageSrc(product)" alt="{{ product.nombre }}" (error)="onImageError($event)">
            <div class="product-placeholder" *ngIf="!getImageSrc(product)">
              <ion-icon [name]="getProductIcon(product.nombre)"></ion-icon>
            </div>
            <div class="product-overlay">
              <button class="btn-icon add-to-cart" (click)="addToCart(product)">
                <ion-icon name="cart"></ion-icon>
              </button>
            </div>
          </div>
          <div class="product-info">
            <h3>{{ product.nombre }}</h3>
            <p>{{ product.descripcion }}</p>
            <div class="product-price">${{ product.precio_unitario.toFixed(2) }}</div>
            <ion-button fill="outline" size="small" (click)="addToCart(product)" [class.animate-success]="animatingProductId === product.id_producto" [class.animate-return]="animatingProductId !== product.id_producto && animatingProductId === null" [disabled]="animatingProductId === product.id_producto">
              <ion-icon name="add-circle" slot="start" [class.animate-success]="animatingProductId === product.id_producto"></ion-icon>
              {{ animatingProductId === product.id_producto ? '¬°Agregado!' : 'Agregar' }}
            </ion-button>
          </div>
        </div>
      </div>

    </div>
  </div>

  </div> <!-- End of content wrapper -->

</ion-content>
