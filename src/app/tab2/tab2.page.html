<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Productos
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="productos-content">


  <!-- Productos Section -->
  <div class="productos-section">
    <div class="container">


      <!-- Filter Buttons -->
      <div class="productos-filter">
        <!-- First Row -->
        <div class="filter-row">
          <button class="filter-btn active" data-filter="todos" (click)="setFilter('todos')">Todos</button>
          <button class="filter-btn" data-filter="Chocolate" (click)="setFilter('Chocolate')">Chocolate</button>
          <button class="filter-btn" data-filter="Sandwich" (click)="setFilter('Sandwich')">Sandwich</button>
        </div>
        <!-- Second Row -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="Bombon" (click)="setFilter('Bombon')">Bomb√≥n</button>
          <button class="filter-btn" data-filter="Caramelo" (click)="setFilter('Caramelo')">Caramelo</button>
          <button class="filter-btn" data-filter="Semilla" (click)="setFilter('Semilla')">Semilla</button>
        </div>
        <!-- Third Row -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="Tradicionales" (click)="setFilter('Tradicionales')">Tradicionales</button>
          <button class="filter-btn" data-filter="Temporales" (click)="setFilter('Temporales')">Temporales</button>
          <button class="filter-btn" data-filter="Solubles" (click)="setFilter('Solubles')">Solubles</button>
        </div>
      </div>

      <!-- Loading/Error Section -->
      <div class="status-section" style="padding: 10px; margin: 10px 0; border-radius: 5px;" [style.background]="getStatusBackground()" *ngIf="isLoading || hasConnectionError">
        <div *ngIf="isLoading" style="text-align: center;">
          <ion-icon name="refresh" style="font-size: 24px; color: #007bff; animation: spin 1s linear infinite;"></ion-icon>
          <div style="margin-top: 5px; font-size: 14px; color: #007bff;">Cargando productos...</div>
        </div>

        <div *ngIf="!isLoading && hasConnectionError" style="text-align: center;">
          <div style="font-size: 16px; color: #dc3545; margin-bottom: 10px;">‚ùå {{ connectionStatus }}</div>
          <button class="retry-btn" (click)="retryConnection()" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
            üîÑ Reintentar
          </button>
        </div>
      </div>

      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>

      <!-- Products Grid -->
      <div class="productos-grid">
        <div class="product-card" *ngFor="let product of filteredProducts">
          <div class="product-image">
            <img *ngIf="product.imagen_base64" [src]="'data:image/jpeg;base64,' + product.imagen_base64" alt="{{ product.nombre }}">
            <img *ngIf="product.imagen && !product.imagen_base64" [src]="product.imagen" alt="{{ product.nombre }}">
            <div class="product-placeholder" *ngIf="!product.imagen && !product.imagen_base64">
              <ion-icon [name]="getProductIcon(product.nombre)"></ion-icon>
            </div>
            <div class="product-overlay">
              <button class="btn-icon add-to-cart" (click)="addToCart(product)">
                <ion-icon name="cart"></ion-icon>
              </button>
            </div>
          </div>
          <div class="product-info">
            <h3>{{ product.nombre }}</h3>
            <p>{{ product.descripcion }}</p>
            <div class="product-price">${{ product.precio_unitario.toFixed(2) }}</div>
            <ion-button fill="outline" size="small" (click)="addToCart(product)">
              <ion-icon name="add-circle" slot="start"></ion-icon>
              Agregar
            </ion-button>
          </div>
        </div>
      </div>

    </div>
  </div>

</ion-content>
